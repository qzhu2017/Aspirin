include lmp.in
replicate 2 2 2

variable    seed equal 74581
variable temperature equal      300.000
variable pressure equal        1.000
variable dt equal        1.000
variable thermo_out_freq equal 1000 
variable dump_out_freq equal 1000
variable tdamp equal 100*${dt}
variable pdamp equal 1000*${dt}
variable pxx equal pxx
variable pyy equal pyy
variable pzz equal pzz

thermo_style    custom step temp ke pe etotal press lx ly lz vol
thermo_modify   lost warn norm yes

# Energy minimization

min_style cg
minimize 1.0e-25 1.0e-25 100000 1000000

thermo ${thermo_out_freq}
thermo_style    custom step temp pe press lx ly lz vol
thermo_modify lost ignore flush yes

neighbor 1.0 bin
neigh_modify every 1 delay 5 check yes
timestep 	${dt}

# NPT equilibration

velocity       all create ${temperature} 1938072 mom yes rot no
fix            1 all npt temp ${temperature} ${temperature} ${tdamp} iso ${pressure} ${pressure} ${pdamp}
fix            2 all momentum 1 linear 1 1 1 rescale

run             500000
unfix       1
unfix       2


# META Simulation with Plumed

dump 1 all custom 100 dump.lammpstrj id type x y z 
dump_modify 1 sort id
dump            myDcdDump all dcd ${dump_out_freq} out.dcd
dump_modify     myDcdDump append yes

fix             1 all plumed plumedfile plumed.dat outfile plumed.out
fix             2 all nph iso ${pressure} ${pressure} ${pdamp}
fix             3 all temp/csvr ${temperature} ${temperature} ${tdamp} ${seed}
#velocity        all create ${temperature} ${seed} dist gaussian

run             500000
unfix       1
unfix       2
unfix       3
